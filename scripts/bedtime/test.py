sample1 = ['Title (English): The Spirit Tree\nTitle (Tetun): Ai Funan Ruhan ', "Part 1 (English): In a large forest in Timor-Leste, there stood an ancient tree that the villagers believed had special powers. The old tree was home to many birds and small animals, and it provided shade on hot days. Because the tree was very special to them, the villagers made sure it was protected and cared for.\nPart 1 (Tetun): Iha ai laran boot ida iha Timor-Leste, iha ona ai tuan ne'ebé ema knua ne'e fiar mak iha abilidade espesiál sira. Ai tuan ne'e nu'udar hela-fatin ba manu oioin no animál ki'ik sira, no fornese mahon bainhira loron manas. Tanba ai ne'e lulik tebes ba sira, ema knua ne'e halo asegura mak iha protesaun no halo kuidadu tebes.", "Part 2 (English): One night, some boys from the village were playing near the old tree. While playing, they accidentally caused a small fire near the tree. The fire started to spread, burning the tree. The boys were scared that the tree would get destroyed, so they called the villagers to help put out the fire. \nPart 2 (Tetun): Loron kalan ida, labarik mane balu husi knua ne'e halimar besik ai tuan. Bainhira halimar, sira tiru ohin tan ho ahi ki'ik ida besik ai. Ahi husi lokalizasaun nee komesa daet, sunu ai. Labarik sira ta'uk ai sei mate, tan nee bolu ema knua atu ajuda hamate ahi.", "Part 3 (English): The villagers came quickly and worked hard to put out the fire. Although the tree was burnt badly, it did not fall. The villagers were overjoyed that their special tree was saved. From that day on, the old tree came to be known as the 'Spirit Tree', the tree that could not be destroyed. The Spirit Tree still stands today, a reminder of that fateful night and a symbol of strength and protection for the villagers.\nPart 3 (Tetun): Ema knua mai lalais no halo servisu toos atu hamate ahi. Maski ai sunu tebes, maibé la monu. Ema knua kontente tebes tanba ai lulik sira nia mak salva ona. Hosi loron ne'ebá, ai tuan ne'e mosu nu'udar 'Ai Funan Ruhan', ai ne'ebé la bele mate. Ai Funan Ruhan sei tuur to'o agora, memoriza loron ne'ebá no simbolu husi forsa no protesaun ba ema knua."]

sample2 = ["Title (English): The Kind-Hearted Woman \nTitle (Tetun): Inan ho Laran Di'ak", "Part 1 (English): There was once a kind-hearted woman in a village who cared for everyone in the community. She gave food to those who were hungry, looked after the sick, and brought water for the thirsty. The villagers were very grateful to her for her kindness.\nPart 1 (Tetun): Dader-dader iha fatin ne'e, iha nia-feto ida ho laran di'ak, ne'ebe kuida ema hotu-hotu iha komunidade la'os. Nia fó han ba ema hamlaha sira, kuida ema moras sira no mos lori bee ba ema hamrook sira. Ema iha vila rezignada nia boot liu tan ba nia tan ha'u nia laran di'ak. ", 'Part 2 (English): The villagers were very grateful to the woman for her kindness. One day, as the woman was returning home, she saw an old man sitting under the hot sun. The old man\'s lips were parched. She gave him water and some fruit. The old man was very grateful. "You have done me a great kindness," he said. "I am a grateful spirit. I will grant you a wish."\nPart 2 (Tetun): Ema iha vila rezignada nia boot liu tan ba nia tan ha\'u nia laran di\'ak. Loron ida, hodi nia-feto fila hamrik rai oin ba uma. Nia haree lisan tua ida tuur iha korokok malirin. Nia halibur ulun mean no mou ida ho mamuk. Lisan tua ne\'e rezignadu ona ho laran. "Ita halo malu ha\'u bee mo matebian di\'ak liu." Hau dehan. "Ha\'u spiritu rezignadu. ha\'u sei fó nia hakarak ida."', 'Part 3 (English): The woman thought for a moment and said, "I wish that I had an ever-filled water jar at home, so I need not go to the well every day to draw water. The old man granted her wish. She returned home to find her water jar always full. The villagers were amazed and praised the woman for her kindness, which was rewarded by the gods. Her good deed brought great joy and comfort to the whole village.\nPart 3 (Tetun): Inan ne\'e hanoin tuir neineik depois dehan, "Ha\'u hakarak iha ha\'u uma laran ona jar bee ulun-metan, entaun ha\'u labele la\'o hela ba emahun lolo-tinan lolo bee. Lisan tua ne\'e kumpri nia hakarak. Nia fila ba uma ona no hetan jar bee duni ulun tan. Ema iha vila haria no fa\'an inan tan ba malu nia laran di\'ak ne\'ebe Maromak halo tuir. Malu nia halo ne\'e mai gosta no kamda luhan ba ema hotu-hotu iha vila la\'os.']

sample3 = ["The Girl Who Loved the Stars\nLabarik Feto Nia ne'ebé Domin Estrela sira ", "Part 1 (English): There once was a young girl named Lara who loved to gaze at the stars. Her village was a small, remote village in the mountains. At night, the sky was clear and filled with brilliant stars. \nPart 1 (Tetun): Dasaeru uma klosan labarik feto ida-ne'ebé naran Lara ne'ebé hadia haree hela estrela sira. Ninia knua mak hosi knua ki'ik ida iha foho. Durante kalan, lalehan mak klara no hatudu estrela sira ne'ebé nabilan. ", "Part 2 (English): One night, Lara's grandmother told her the story of the goddess who created the first sunrise by sacrificing herself. Lara was captivated and moved by the story. She wondered if the stars were souls who had found peace.\nPart 2 (Tetun): Loron ida, Lara ninia avo-feto mós habele istória kona-ba ninia sira-nee hosi deusa ne'ebé halo iha sunu komesa ninia an. Lara mak halo ona atrais no lori husi istória. Nia hanoin karik estrela sira mak alma ne'ebé hetan pás.", 'Part 3 (English): Inspired, Lara decided to make an offering to the stars to show her gratitude. She picked flowers and stitched together a colorful mat. That night, she brought her offering outside, gazed up at the brilliant stars and said, "Thank you for shining your light on our world." \nPart 3 (Tetun): Ho inspiris, Lara deside halo hanesan on ha\'u nia domín ba estrela sira hodi hatudu lolos. Nia hili ai-funan sira no suku hamutuk taulele. Loron kalan ne\'e, nia haruka hanesan tebes iha liur, haree hela estrela sira nabilan no dehan, "Obrigada ba hatudu ita-nia matenek iha ita-nia mundu."']
sample4 = ["Title (English): The Firefly's Gift \nTitle (Tetun): Rei Hamos Hadia ", 'Part 1 (English): The old forest was dark at night. The ancient trees stretched up high into the black sky, their leafy arms obscuring the stars. When the moon rose, silvery shafts of light pierced the canopy and dappled the forest floor. ', "Part 1 (Tetun): Ai-laran tuan ne'e nakukun iha kalan. Ai-hun sira ne'ebé tuan ona harahun aas ba letehan metan, sira nia liman fuin taka estrela sira. Bainhira loro sa'e, rai fulan nabilan tesi ai-hun nia ai-tahan no halo padraun iha ai-laran nia rai.", 'Part 2 (English): In a hidden grove deep within the ancient forest, there lived thousands of tiny fireflies. At night, they emerged from the thick foliage and with a magical flash of light, lit up the darkness. The forest creatures were grateful for the soft glow that lit their way.', "Part 2 (Tetun): Iha ai-laran kle'an loke iha ai-laran tuan, iha ema moris milhares fireflies ki'ik. Iha kalan, sira mosu husi ai-tahan na'in no ho fellez naroman májiku, nabilan nakukun. Ai-laran nia rai lisan sira hatene ona ho nabilan ne'ebé fó dalan ba sira.", 'Part 3 (English): One night, a lost fawn wandered into the sacred grove, frightened by the unfamiliar sounds. The fireflies sensed her fear and surrounded her, bathing her in their golden light. “Do not be afraid,” they whispered. “We are here to guide lost souls to safety.” The fawn followed the trail of fireflies to the edge of the forest where she was reunited with her mother. The fireflies had given her a precious gift - the gift of light to find her way through the darkness.', 'Part 3 (Tetun): Kalan ida, babore metan lakon sena halo dalan sala ho sunu seluk. Fireflies sira hatene nia ta\'uk no serka nia, fó nia naroman ne\'ebé mean. "Labele ta\'uk," sira bisik. "Ami hela ona hodi matadalan ema lakon ba seguru." Babore ne\'e tuir fireflies nia dalan too ai laran nia kraik, iha ne\'ebá nia hasoru fali nia inan. Fireflies sira fó nia prezente valiozu - prezente naroman hodi hetan nia dalan liu husi nakukun.']
sample5 = ['Title (English): The sacred training\nTitle (Tetun): Formasaun lulik', 'Part 1 (English): Loro was a young boy of the Kemak tribe, living in a small mountain village. One night, he dreamed of two mystical ravens speaking to him. They told Loro he had been chosen to learn the ancient ways of healing. The next morning, Loro told his father about the dream. His father\'s eyes grew wide. "The spirits have chosen you, my son," he said. "You must go to the healers\' sacred mountain and begin your training."\nPart 1 (Tetun): Loro mak labarik mane joven baibain husi suku Kemak ne\'ebé, hela iha knua foho ki\'ik ida. Loron ida kalan, nia mehi iha rai-doru nain rua ko\'alia ho nia. Sira sohan ba Loro katak nia mak nu\'udar ona liu tan atu aprende dalan tuan loke no sa\'e ai-moruk. Loron tuirmai, Loro hatudu ba nia aman kona ba nia mehi ne\'e. Nia aman nia matan aas. "Iha hundue nega, oan ha\'u, baluka spirutu sila hiji tua mós halo hili," hatete nia. "Tenke malu, oan, bá ba foho ne\'ebalu ai-moruk ho fatin lulik no komesa aprende."', "Part 2 (English): The next day, Loro set off up the winding path to the sacred mountain. After many days of difficult climbing, he arrived at the healers' village. The healers greeted him and began his training. They taught him which plants could heal sickness, and which plants must only be used in ceremonies. Loro learned the chants and dances to call upon the spirits. His favorite teacher was an old woman who taught him the magic of healing broken bones and wounds. Loro soaked up their knowledge like heavy rains in the forest.\nPart 2 (Tetun): Loron tuir mai, Loro sa'e ba dalan-dobua foho lulik ne'e. Suku Loro tinan hela besik rai iha fatin ne'ebé mós sulit tebes ba. Aprende kona ba nia hundue te'in. Sira hatudu ba Loro dadus no hanoin ne'e hahú, forma tiha no haruka. Sira hanorin nia kona ba ai lubuk ne'ebé bele te'in saúde ho ai lubuk tenke uza iha seremonia de'it. Loro aprende ona kanta no baile atu bolu hundue sira. Nia hundue tinan favoritu mak feto tuan ida ne'ebé ona hanorin hundue halibur ne'ebé hadia isin fuan kaset ho nusa. Loro merkaju nia hundue ne'ebé ho tun hanesan tun rain boot iha ai-laran.", 'Part 3 (English): After many years, Loro returned home with the power to heal his tribe. The ravens returned in a dream and told him, "You have learned well, Loro. Now use your gift to help your people." Loro awoke with a sense of purpose. He built a house near the village and became the healer of the Kemak tribe. On his first day in his new home, an old man came to him with an infected wound. Loro closed his eyes and recalled the healing chants. When he opened them again, the infection had cleared and the wound was closed. The old man danced with joy. And Loro smiled, for he knew his training on the sacred mountain had truly begun.\nPart 3 (Tetun): Neineik tinan barak tiha, Loro fila fali ho ninia suku ho moda atu te\'in. Afetos mai dala ida tan iha nia mehi no hatete ba nia,  "oni aprende di\'ak, Loro. Agora uza ita-nia to\'o atu ajuda ita-nia povu." Loro hare balo no komprende ninia misaun. Nia komesa harii uma besik knua hundue ona sai ema te\'in tribu kemak. Loron oin nia iha nia uma foun, mane tuan mai ho uza nusa tebes. Loro hare tiha no hanoin bainhira le\'e kantu te\'in. Bainhira hare loke dala ikun, infesaun liu tan no nusa hákete nafatin. Mane idade tu\'un kantu ho fiar. No Loro hakerek hundue, nia hanoin nia formasaun iha fatin lulik mak di\'ak tiha ona.']

def parse_story(content):
    story = {'title': {'english': '', 'tetun': ''}, 'parts': []}
    
    if not content or not isinstance(content, list):
        print("Error: Invalid or empty content")
        return story

    # Parse title
    if content[0].startswith('Title'):
        title_parts = content[0].split('\n')
        story['title']['english'] = title_parts[0].split('Title (English):')[1].strip()
        story['title']['tetun'] = title_parts[1].split('Title (Tetun):')[1].strip()
    else:
        print("Error: Title not found in the expected format")
        return story

    # Parse parts using the split_and_strip method
    story['parts'] = parse_parts_split_and_strip(content[1:])
    
    # If no parts were found, try the fallback method
    if not story['parts']:
        story['parts'] = parse_parts_fallback(content[1:])

    if not story['parts']:
        print("Error: No story parts found")
        return story

    return story
    
def parse_parts_split_and_strip(content):
    parts = []
    for item in content:
        if item.startswith('Part'):
            part = {'part_number': 0, 'english': '', 'tetun': ''}
            part['part_number'] = int(item.split()[1])
            english_start = item.find('(English):')
            tetun_start = item.find('(Tetun):')
            if english_start != -1 and tetun_start != -1:
                part['english'] = item[english_start+10:tetun_start].strip().split('Part')[0].strip()
                part['tetun'] = item[tetun_start+8:].strip().split('Part')[0].strip()
            parts.append(part)
    return parts

def parse_parts_fallback(content):
    parts = []
    full_content = ' '.join(content)
    part_markers = ['Part 1', 'Part 2', 'Part 3', 'Part 4', 'Part 5']
    for i, marker in enumerate(part_markers):
        start = full_content.find(marker)
        if start == -1:
            break
        end = full_content.find(part_markers[i+1]) if i+1 < len(part_markers) else len(full_content)
        part_content = full_content[start:end]
        part = {'part_number': int(marker.split()[1]), 'english': '', 'tetun': ''}
        english_start = part_content.find('(English):')
        tetun_start = part_content.find('(Tetun):')
        if english_start != -1 and tetun_start != -1:
            part['english'] = part_content[english_start+10:tetun_start].strip().split('Part')[0].strip()
            part['tetun'] = part_content[tetun_start+8:].split('Part')[0].strip()
        parts.append(part)
    return parts
    
def test_parsing_methods(sample):
    print("Testing with sample:")
    print(sample)
    print("\nresults:")
    print(parse_story('!!!' + sample + '!!!'))
    print("\n" + "="*50 + "\n")

test_parsing_methods(sample1)
test_parsing_methods(sample2)
test_parsing_methods(sample3)
test_parsing_methods(sample4)
test_parsing_methods(sample5)